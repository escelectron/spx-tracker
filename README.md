# SPX Daily Range Tracker

This web application fetches daily SPX (S&P 500) and VIX (Volatility Index) data to calculate and display predicted 1-sigma (1σ) and 2-sigma (2σ) price ranges for the next trading day.

The app consists of two main components:
* `fetch_data.py`: A script to be run daily that fetches data from yfinance, performs all calculations, and saves the results to `spx_data.json` (for the chart) and `display_data.json` (for the stat cards).
* `app.py`: A Flask web application that reads the JSON data files and displays them in an interactive Plotly chart and a series of dashboard cards.

## 1. Local Development Setup

Follow these steps to run the application on your local machine for development and testing.

### Prerequisites
* Python 3.9+
* Git

### Steps
1.  **Clone the repository:**
    ```bash    
    git clone https://github.com/escelectron/spx-tracker.git
cd spx-tracker
    cd spx-tracker
    ```

2.  **Create and activate a virtual environment:**
    * **macOS/Linux:**
        ```bash
        python3 -m venv venv
        source venv/bin/activate
        ```
    * **Windows:**
        ```bash
        python -m venv venv
        .\venv\Scripts\activate
        ```

3.  **Install dependencies:**
    ```bash
    pip install -r requirements.txt
    ```

4.  **Run the data fetch script:**
    This is a crucial first step. The web app will not work until the `spx_data.json` and `display_data.json` files are created.
    ```bash
    python fetch_data.py
    ```
    You should see a "Successfully saved..." message.

5.  **Run the Flask application:**
    ```bash
    python app.py
    ```

6.  **View your app:**
    Open your web browser and go to **http://127.0.0.1:10000**. You should see your live application.

## 2. Deployment to PythonAnywhere

This guide covers the initial, one-time setup to get your app running on PythonAnywhere.

### Part A: GitHub Setup (One-Time)

Before deploying, you need a good `.gitignore` file in your repository to avoid committing your virtual environment and data files.

1.  Create a file named `.gitignore` in the root of your `spx-tracker` directory.
2.  Add the following content. This tells Git to ignore your local environment and the data files (which will be generated *on the server*).

    ```.gitignore
    # Python
    venv/
    *.pyc
    __pycache__/
    
    # Data Files (Generated by fetch_script.py)
    *.json
    ```
3.  Commit and push your code to GitHub:
    ```bash
    git add .
    git commit -m "Initial app commit with .gitignore"
    git push origin main
    ```

### Part B: PythonAnywhere Configuration

1.  **Create the Web App:**
    * Log in to PythonAnywhere and go to the **Dashboard**.
    * Click the **Web** tab and create a new web app.
    * Select **Flask** and the **Python** version (e.g., Python 3.10).
    * The path will be set (e.g., `/home/spx-spranav/mysite`). **Delete this default `mysite` directory.**

2.  **Clone Your Repo:**
    * Go to the **Consoles** tab and open a **Bash** console.
    * Clone your repository (this will create the `spx-tracker` directory):
        ```bash
        git clone [https://github.com/escelectron/spx-tracker.git](https://github.com/escelectron/spx-tracker.git)
        ```

3.  **Configure the Web Tab:**
    * Go back to the **Web** tab.
    * In the **Code** section:
        * Set **Source code:** `/home/spx-spranav/spx-tracker`
        * Set **Working directory:** `/home/spx-spranav/spx-tracker`
    * In the **Virtualenv** section:
        * Enter the path to a new virtual environment: `/home/spx-spranav/spx-tracker/venv`
        * Click the link to **create it**.

4.  **Install Dependencies in the Server Venv:**
    * Open a new **Bash** console.
    * Activate the virtual environment you just created and install the requirements:
        ```bash
        cd ~/spx-tracker
        source venv/bin/activate
        pip install -r requirements.txt
        ```

5.  **Configure the WSGI File:**
    * On the **Web** tab, click the link to the **WSGI configuration file**.
    * Delete the contents and replace them with this, making sure the `path` and `app` import are correct:

        ```python
        import sys
        
        # Set the path to your project
        path = '/home/spx-spranav/spx-tracker'
        if path not in sys.path:
            sys.path.insert(0, path)
        
        # Import the Flask app object
        from app import app as application
        ```
    * Save the file.

6.  **Set Up the Scheduled Task (Most Important!)**
    * The app will *not* work yet because the `.json` files don't exist on the server.
    * Go to the **Tasks** tab.
    * Create a new **Scheduled task**.
    * Set it to run **Daily** at a time of your choice (e.g., after the US market closes).
    * Enter the following command. This activates your venv and runs the data fetch script:
        ```bash
        cd /home/spx-spranav/spx-tracker && /home/spx-spranav/spx-tracker/venv/bin/python fetch_data.py
        ```
    * Save the task.

7.  **Run the Task & Launch:**
    * On the **Tasks** tab, click the **Run** button (▶️) for the task you just created. This will run it immediately and generate the `.json` files.
    * Go to the **Web** tab and click the green **Reload** button.
    * Your site `https://spx-spranav.pythonanywhere.com` is now live!

## 3. How to Update Your Live App (CI/CD Workflow)

This is the "Continuous Deployment" process you will follow every time you want to update your live app with new code.

1.  **Local Machine:** Make your code changes (e.g., edit `app.py` or the HTML template).

2.  **Local Machine:** Commit and push the changes to GitHub.
    ```bash
    git add .
    git commit -m "A description of my new feature"
    git push origin main
    ```

3.  **PythonAnywhere:** Log in.
    * Go to the **Consoles** tab and open a **Bash** console.

4.  **PythonAnywhere:** In the console, navigate to your project directory and pull the changes from GitHub:
    ```bash
    cd ~/spx-tracker
    git pull
    ```

5.  **PythonAnywhere:** (Only if you changed `requirements.txt`)
    * If you added or changed any packages, you must re-install them in your server's virtual environment:
        ```bash
        source venv/bin/activate
        pip install -r requirements.txt
        ```

6.  **PythonAnywhere:** Go to the **Web** tab.
    * Click the green **Reload** button for your web app.

Your site is now updated with the new code.
